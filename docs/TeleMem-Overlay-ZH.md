<div align="center">
  <h1>TeleMem Overlay å¼€å‘è¯´æ˜</h1>
  <p>
      <a href="TeleMem-Overlay.md">English</a> | <a href="TeleMem-Overlay-ZH.md">ç®€ä½“ä¸­æ–‡</a>
  </p>
</div>

> **ç›®æ ‡**ï¼šåœ¨ä¸ç›´æ¥ä¿®æ”¹ä¸Šæ¸¸ä»“åº“ï¼ˆå¦‚ [mem0](https://github.com/mem0ai/mem0)ï¼‰çš„æƒ…å†µä¸‹ï¼Œä¸ºå…¶æ·»åŠ æ‰©å±•åŠŸèƒ½ï¼ˆå¦‚è‡ªå®šä¹‰ `Memory.add()` è¡Œä¸ºï¼‰ï¼Œå¹¶ä¿æŒå¯éšæ—¶åŒæ­¥ä¸Šæ¸¸æ›´æ–°ã€‚

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
telemem/
â”œâ”€â”€ assets/                   # æ–‡æ¡£èµ„æºä¸æ’å›¾ç´ æ
â”œâ”€â”€ vendor/
â”‚   â””â”€â”€ mem0/                 # ä¸Šæ¸¸ Mem0 ä»“åº“æºä»£ç ï¼ˆé€šè¿‡ git subtree å¼•å…¥ï¼‰
â”œâ”€â”€ overlay/
â”‚   â””â”€â”€ patches/              # TeleMem è‡ªå®šä¹‰è¡¥ä¸æ–‡ä»¶ï¼ˆ.patchï¼‰ï¼Œç”¨äºæ‰©å±•ä¸ä¿®æ”¹ä¸Šæ¸¸ä»£ç 
â”œâ”€â”€ scripts/                  # Overlay ç®¡ç†ä¸è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ init_upstream.sh      # åˆå§‹åŒ–ä¸Šæ¸¸ subtree ä»“åº“
â”‚   â”œâ”€â”€ update_upstream.sh    # åŒæ­¥ä¸Šæ¸¸æ›´æ–°å¹¶é‡æ–°åº”ç”¨ TeleMem è¡¥ä¸
â”‚   â”œâ”€â”€ record_patch.sh       # å°†æœ¬åœ°ä»£ç ä¿®æ”¹è®°å½•ä¸ºå¯å¤ç°çš„è¡¥ä¸æ–‡ä»¶
â”‚   â””â”€â”€ apply_patches.sh      # åº”ç”¨è¡¥ä¸æ„å»º TeleMem å®Œæ•´ä»£ç 
â”œâ”€â”€ baselines/                # å¯¹æ¯”è¯„æµ‹ä½¿ç”¨çš„åŸºçº¿æ–¹æ³•å®ç°
â”‚   â”œâ”€â”€ RAG                   # Retrieval-Augmented Generationï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰åŸºçº¿
â”‚   â”œâ”€â”€ MemoBase              # MemoBase è®°å¿†ç®¡ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ MOOM                  # MOOM åŒåˆ†æ”¯å™äº‹è®°å¿†æ¡†æ¶
â”‚   â”œâ”€â”€ A-mem                 # A-mem æ™ºèƒ½ä½“è®°å¿†ç³»ç»ŸåŸºçº¿
â”‚   â””â”€â”€ Mem0                  # Mem0 åŸºçº¿å®ç°
â”œâ”€â”€ data/                     # ç”¨äºè¯„æµ‹æˆ–æ¼”ç¤ºçš„å°è§„æ¨¡ç¤ºä¾‹æ•°æ®é›†
â”œâ”€â”€ examples/                 # ç¤ºä¾‹ä»£ç ä¸æ•™ç¨‹ Demo
â”‚   â”œâ”€â”€ quickstart.py         # å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ï¼ˆæ–‡æœ¬è®°å¿†ï¼‰
â”‚   â””â”€â”€ quickstart_mm.py      # å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ï¼ˆå¤šæ¨¡æ€è®°å¿†ï¼‰
â”œâ”€â”€ docs/                     # é¡¹ç›®æ–‡æ¡£ã€æ•™ç¨‹ä¸å¼€å‘è€…æŒ‡å—
â”‚   â”œâ”€â”€ TeleMem-Overlay.md    # Overlay å¼€å‘æŒ‡å—ï¼ˆè‹±æ–‡ç‰ˆï¼‰
â”‚   â”œâ”€â”€ TeleMem-Overlay-ZH.md # Overlay å¼€å‘æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰
â”‚   â””â”€â”€ README-ZH.md          # é¡¹ç›®ä¸­æ–‡è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ PATCHES.md                # TeleMem è¡¥ä¸åˆ—è¡¨åŠåŠŸèƒ½è¯´æ˜
â””â”€â”€ README.md                 # é¡¹ç›®è‹±æ–‡æ€»è¯´æ˜æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

---

## ğŸ§© Overlay æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ

Overlay æ¨¡å¼æ˜¯ä¸€ç§è½»é‡åŒ–çš„ä¸Šæ¸¸æ‰©å±•æ–¹å¼ï¼Œå®ƒå…è®¸ä½ ï¼š

- **ä¿ç•™ä¸Šæ¸¸ä»“åº“çš„åŸå§‹ä»£ç **ï¼ˆå¹²å‡€ã€å¯æ›´æ–°ï¼‰ï¼›
- **åœ¨æœ¬åœ°æ·»åŠ åŠŸèƒ½æˆ–ä¿®å¤**ï¼Œå¹¶å°†æ”¹åŠ¨ä¿å­˜ä¸ºè¡¥ä¸æ–‡ä»¶ï¼›
- **ä¸€é”®åŒæ­¥ä¸Šæ¸¸æ›´æ–°å¹¶é‡æ–°æ‰“è¡¥ä¸**ã€‚

ä½ ä¸éœ€è¦æ”¹åŠ¨ä¸Šæ¸¸çš„ git å†å²ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤ä¸€ä¸ªé•¿æœŸåˆ†å‰ï¼ˆforkï¼‰ã€‚  

---

## âš™ï¸ åˆå§‹åŒ–ä¸Šæ¸¸ä»“åº“

ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ï¼Œæ‰§è¡Œï¼š

```bash
export UPSTREAM_REPO="https://github.com/mem0ai/mem0.git"
export UPSTREAM_REF="main"
bash scripts/init_upstream.sh
```

è¿™ä¼šï¼š

- ä¸‹è½½ä¸Šæ¸¸ä»“åº“ï¼›
- æ”¾å…¥ `vendor/mem0/`ï¼›
- è‡ªåŠ¨åˆ›å»ºåˆå§‹æäº¤ã€‚

---

## ğŸ§± åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè¡¥ä¸

å‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹ä¸Šæ¸¸çš„ `Memory.add()` å‡½æ•°ï¼ŒåŠ ä¸€è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚

### 1ï¸âƒ£ ä¿®æ”¹ä¸Šæ¸¸ä»£ç 

ç¼–è¾‘æ–‡ä»¶ï¼š

```bash
vim vendor/mem0/mem0/memory/main.py
```

æ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼š

```python
def add(self, *args, **kwargs):
    print("[TeleMem] Hook before add()")  # custom extension
    return super().add(*args, **kwargs)
```

---

### 2ï¸âƒ£ è®°å½•è¡¥ä¸

æ‰§è¡Œå‘½ä»¤ï¼š

```bash
bash scripts/record_patch.sh add-memory-hook
```

è„šæœ¬ä¼šï¼š

- æå– `vendor/mem0` çš„æ”¹åŠ¨ï¼›
- ä¿å­˜ä¸º `overlay/patches/add-memory-hook.patch`ï¼›
- åœ¨ `PATCHES.md` é‡Œè®°å½•è¯´æ˜ï¼›
- æé†’ä½ æ¢å¤ä¸Šæ¸¸ä¸ºå¹²å‡€çŠ¶æ€ã€‚

---

### 3ï¸âƒ£ æ¢å¤ä¸Šæ¸¸ä»£ç 

å› ä¸º `vendor/mem0` æ˜¯åªè¯»åŒºåŸŸï¼ˆå­˜æ”¾å¹²å‡€çš„ä¸Šæ¸¸ä»£ç ï¼‰ï¼Œ  
æˆ‘ä»¬æ¢å¤åŸæ ·ä»¥ä¿æŒå¯åŒæ­¥æ€§ï¼š

```bash
git checkout vendor/mem0
```

---

### 4ï¸âƒ£ åº”ç”¨è¡¥ä¸

å½“ä½ éœ€è¦è¿è¡Œæˆ–æ„å»ºæ—¶ï¼Œé‡æ–°æ‰“ä¸Šè¡¥ä¸ï¼š

```bash
bash scripts/apply_patches.sh
```

è¿™ä¼šå°†æ‰€æœ‰ `.patch` æ–‡ä»¶æŒ‰é¡ºåºè‡ªåŠ¨åº”ç”¨åˆ° `vendor/mem0/`ã€‚

---

## ğŸ” åŒæ­¥ä¸Šæ¸¸æ›´æ–°

å½“ä¸Šæ¸¸ï¼ˆmem0ï¼‰å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
bash scripts/update_upstream.sh
```

å®ƒä¼šè‡ªåŠ¨ï¼š

1. æ‹‰å–ä¸Šæ¸¸æœ€æ–°ç‰ˆæœ¬ï¼›
2. æ‰§è¡Œ `apply_patches.sh`ï¼›
3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†²çªï¼ˆè‹¥æœ‰éœ€æ‰‹åŠ¨è°ƒæ•´ patchï¼‰ã€‚

---

## ğŸ§° ç®¡ç†è¡¥ä¸

æ‰€æœ‰è¡¥ä¸éƒ½ä½äºï¼š

```
overlay/patches/*.patch
```

æ¯ä¸ªè¡¥ä¸å¯¹åº”ä¸€ä¸ªé€»è¾‘ä¿®æ”¹ç‚¹ï¼Œä¾‹å¦‚ï¼š

- `add-memory-hook.patch`  
- `fix-config-loading.patch`  
- `extend-llm-registry.patch`  

ä½ å¯ä»¥åœ¨ `PATCHES.md` ä¸­ç»´æŠ¤è¯´æ˜ï¼Œä¾‹å¦‚ï¼š

```markdown
# PATCHES.md

- add-memory-hook (2025-10-23): Add TeleMem hook before Memory.add()
- extend-llm-registry (2025-10-24): Add new provider registry hook for reranker
```

---

## ğŸ§© è„šæœ¬è¯´æ˜

| è„šæœ¬ | ä½œç”¨ | ç”¨æ³• |
|------|------|------|
| `init_upstream.sh` | ç¬¬ä¸€æ¬¡å¼•å…¥ä¸Šæ¸¸ä»£ç  | `bash scripts/init_upstream.sh` |
| `update_upstream.sh` | ä»ä¸Šæ¸¸æ›´æ–°å¹¶è‡ªåŠ¨é‡æ‰“è¡¥ä¸ | `bash scripts/update_upstream.sh` |
| `record_patch.sh` | å°†å½“å‰å¯¹ä¸Šæ¸¸çš„æ”¹åŠ¨ä¿å­˜ä¸ºè¡¥ä¸ | `bash scripts/record_patch.sh <patch-name>` |
| `apply_patches.sh` | é‡æ–°åº”ç”¨æ‰€æœ‰è¡¥ä¸ | `bash scripts/apply_patches.sh` |

---

## ğŸ§© ä½¿ç”¨å»ºè®®

- æ¯ä¸ªé€»è¾‘ä¿®æ”¹åªç”Ÿæˆä¸€ä¸ªè¡¥ä¸ï¼Œ**ä¿æŒç²’åº¦å°ï¼ˆâ‰¤10 ä¸ªè¡¥ä¸ï¼‰**
- **ä¸è¦ç›´æ¥æäº¤ä¿®æ”¹åçš„ vendor/** å†…å®¹ï¼›
- ä»»ä½•æ—¶å€™æƒ³æµ‹è¯•æˆ–æ„å»ºï¼Œå¯æ‰§è¡Œï¼š
  ```bash
  bash scripts/apply_patches.sh
  ```
- åŒæ­¥ä¸Šæ¸¸æ—¶æ€»æ˜¯é€šè¿‡ï¼š
  ```bash
  bash scripts/update_upstream.sh
  ```
- å¦‚æœä¸Šæ¸¸æœ‰å†²çªï¼Œä¼˜å…ˆè€ƒè™‘åœ¨ä¸Šæ¸¸ä»“åº“æ PR å¢åŠ ã€Œhookã€ç‚¹ã€‚

---

## ğŸ§© å·¥ä½œæµç¨‹ä¸€è§ˆ

```bash
# ç¬¬ä¸€æ¬¡åˆå§‹åŒ–
bash scripts/init_upstream.sh

# ä¿®æ”¹ä¸Šæ¸¸ï¼ˆvendor/mem0ï¼‰
vim vendor/mem0/mem0/memory/main.py

# è®°å½•æ”¹åŠ¨
bash scripts/record_patch.sh add-memory-hook

# æ¢å¤ä¸Šæ¸¸
git checkout vendor/mem0

# æ„å»ºæˆ–è¿è¡Œå‰é‡æ–°æ‰“è¡¥ä¸
bash scripts/apply_patches.sh

# å½“ä¸Šæ¸¸æ›´æ–°
bash scripts/update_upstream.sh
```

---

## âœ… ä¼˜ç‚¹æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| âœ… æ— éœ€ fork | ä¸ç»´æŠ¤è‡ªå·±çš„ mem0 åˆ†æ”¯ |
| âœ… æ˜“äºåŒæ­¥ | `subtree pull` + `apply_patches` |
| âœ… æ”¹åŠ¨å¯è¿½è¸ª | æ‰€æœ‰ä¿®æ”¹éƒ½åœ¨è¡¥ä¸æ–‡ä»¶ä¸­ |
| âœ… è‡ªåŠ¨åŒ–è„šæœ¬ | è½»æ¾é‡å»ºä»»ä½•ç‰ˆæœ¬ |
| âœ… å¯å®¡è®¡ | `PATCHES.md` è®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ¥æºå’Œç†ç”± |

---

## ğŸ” æ³¨æ„äº‹é¡¹

- `vendor/mem0` ä¸­çš„æ–‡ä»¶æ°¸è¿œä¸åº”ç›´æ¥ commitï¼›
- å¦‚æœ patch å¤±è´¥ï¼ˆå†²çªï¼‰ï¼Œè¯·ä½¿ç”¨ `git apply --reject` æ‰‹åŠ¨ä¿®å¤ï¼›
- å§‹ç»ˆä¿æŒ `PATCHES.md` æ›´æ–°ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œï¼›
- æ¨èå°† `overlay/patches` å’Œ `scripts` ä¸€å¹¶æäº¤å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚
